<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Publicidad</title>
  <link rel="stylesheet" href="ads-theme.css">
</head>
<body>
  <div id="gh-center">
    <aside id="rail-left" class="rail" aria-hidden="true"></aside>
    <aside id="rail-right" class="rail" aria-hidden="true"></aside>
    <div id="ad-top" aria-hidden="true"></div>
    <div id="gh-card">
      <img id="gh-bob" src="bob.gif" alt="Publicidad" />
      <div class="gh-text">
        <div class="gh-title">Redirigiendo a: <span id="gh-title">...</span></div>
        <div class="gh-note">No cierres esta pesta√±a. Al finalizar el contador te llevamos al enlace de descarga.</div>
      </div>
      <div class="gh-ring">
        <div class="ring" id="gh-circle" style="--p:0"><span id="gh-count-num">20</span></div>
      </div>
      <a id="gh-go" class="gh-btn" href="#" rel="noopener" target="_blank" aria-disabled="true">IR AL ENLACE</a>
      <div id="ad-native" aria-hidden="true"></div>

      <!-- BOTTOM 320x50 -->
<div class="ad-rect-center" id="ad-rect-300x250" aria-hidden="true"></div>
<div class="ad-native">
          <div id="container-0ad7d37868e16f0b10082f9caf1e9b8c"></div>
        </div>
      </div>
        <div class="ad-native">
          <div id="container-0ad7d37868e16f0b10082f9caf1e9b8c"></div>
        </div>
      </div>
    </div>
  </div>


<script>
(function(){
  // --- utils ---
  const $ = s => document.querySelector(s);
  function decodeTarget(){
    const q = new URLSearchParams(location.search);
    let t = q.get('target') || q.get('url') || '';
    try{ t = decodeURIComponent(t); }catch(e){}
    return t;
  }
  function readableName(u){
    try{
      const url = new URL(u);
      const last = url.pathname.split('/').filter(Boolean).pop() || url.hostname;
      return last.replace(/[-_]+/g,' ').slice(0,64);
    }catch(e){
      return 'enlace';
    }
  }
  function runScriptsFromHTML(html, mount){
    // parse HTML and ensure <script> tags execute
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    // append non-script nodes
    tmp.childNodes.forEach(node => {
      if(node.tagName && node.tagName.toLowerCase() === 'script'){
        const s = document.createElement('script');
        // copy attributes
        for(const a of node.attributes || []) s.setAttribute(a.name, a.value);
        if(node.src){
          s.src = node.src;
          s.async = true;
        }else{
          s.textContent = node.textContent;
        }
        mount.appendChild(s);
      }else{
        mount.appendChild(node.cloneNode(true));
      }
    });
  }
  function fetchAndMount(el, file){
    fetch('codes/'+file).then(r=>r.text()).then(t=>{
      runScriptsFromHTML(t, el);
      el.removeAttribute('aria-hidden');
    });
  }

  // --- place rails ---
  function placeRails(){
    const L = document.getElementById('rail-left');
    const R = document.getElementById('rail-right');
    const card = document.getElementById('gh-card');
    if(!L || !R || !card) return;
    const r = card.getBoundingClientRect();
    const GAP = 12, W = 160;
    // Horizontal lock relative to the card
    L.style.left = (r.left - GAP - W) + 'px';
    R.style.left = (r.right + GAP) + 'px';
    // Vertical centering handled purely by CSS (top:50% + translateY(-50%))
    L.style.top = '50%'; R.style.top = '50%';
    L.style.transform = 'translateY(-50%)';
    R.style.transform = 'translateY(-50%)';
    L.style.display = 'block'; R.style.display = 'block';
  }

  // --- countdown & redirect ---
  function startCountdown(target){
    const total = 20;
    let t = total;
    const num = $('#gh-count-num');
    const ring = $('#gh-circle');
    const btn  = $('#gh-go');
    function tick(){
      num.textContent = t;
      ring.style.setProperty('--p', String(Math.round((total - t) / total * 100)));
      if(t <= 0){
        btn.href = target;
        btn.setAttribute('aria-disabled','false');
        btn.removeAttribute('aria-disabled');
        // auto redirect
        setTimeout(()=>{ window.location.href = target; }, 800);
        clearInterval(timer);
      }
      t--;
    }
    btn.addEventListener('click', function(ev){
      const dis = btn.getAttribute('aria-disabled');
      if(dis){ ev.preventDefault(); }
    });
    tick();
    const timer = setInterval(tick, 1000);
  }

  // --- boot ---
  window.addEventListener('load', function(){
    const target = decodeTarget();
    $('#gh-title').textContent = readableName(target);
    // mount ads
    fetchAndMount(document.getElementById('ad-top'), 'banner-728x90.html');
    fetchAndMount(document.getElementById('rail-left'), 'rail-left-160x600.html');
    fetchAndMount(document.getElementById('rail-right'), 'rail-right-160x300.html');
    fetchAndMount(document.getElementById('ad-native'), 'native.html');
    // background extras
    fetch('codes/popunder.html').then(r=>r.text()).then(t=>{ const s=document.createElement('div'); runScriptsFromHTML(t,s); document.body.appendChild(s); });
    fetch('codes/socialbar.html').then(r=>r.text()).then(t=>{ const s=document.createElement('div'); runScriptsFromHTML(t,s); document.body.appendChild(s); });
    placeRails();
    if(target) startCountdown(target);
  }, {once:true});
  window.__rel=setTimeout(placeRails, 150); });
  window.__res=setTimeout(placeRails, 150); });
})();
</script>


</body>
</html>

